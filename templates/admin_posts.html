{% extends "base.html" %}
{% block content %}
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h3 class="mb-0">My Posts{% if user.is_admin %} (All){% endif %}</h3>
    <a href="/admin/new_post" class="btn btn-primary">＋ New</a>
  </div>

  <table class="table align-middle">
    <thead>
      <tr><th>ID</th><th>Title</th><th>Artist</th><th>Hearts</th><th>Created</th><th></th></tr>
    </thead>
    <tbody>
      {% for p in posts %}
      <tr>
        <td>{{ p.id }}</td>
        <td><a href="/p/{{ p.slug or p.id }}">{{ p.title }}</a></td>
        <td>
          {% if p.artist %}
            <a href="/artist/{{ p.artist.slug or p.artist.id }}">{{ p.artist.name }}</a>
            {% if not user.is_admin and p.artist.owner_id == user.id %}
              <span class="badge bg-success ms-1">自分</span>
            {% endif %}
          {% else %}
            -
          {% endif %}
        </td>
        <td>♥ {{ p.likes or 0 }}</td>
        <td>{{ p.created_at.strftime("%Y-%m-%d") if p.created_at else "-" }}</td>
        <td class="text-end">
          {% if p.can_edit %}
            <a class="btn btn-sm btn-outline-primary me-1" href="/admin/posts/{{ p.id }}/edit">Edit</a>
            <form method="post" action="{{ request.url_for('admin_post_delete', post_id=p.id) }}" class="d-inline" onsubmit="return confirm('Delete this post?');">
              <button class="btn btn-sm btn-outline-danger">Delete</button>
            </form>
          {% else %}
            <span class="text-muted small">編集権限なし</span>
          {% endif %}
        </td>
      </tr>
      {% else %}
      <tr><td colspan="6" class="text-muted">投稿がありません</td></tr>
      {% endfor %}
    </tbody>
  </table>
  
  {% if not user.is_admin %}
  <div class="alert alert-info mt-3">
    <small>※ 自分に紐付けられたアーティストの投稿のみ編集・削除できます。</small>
  </div>
  {% endif %}
{% endblock %}