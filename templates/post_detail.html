{% extends "base.html" %}

{% block title %}{{ post.title }} / {{ post.artist.name }} | Chilaq - もっと、好きな音楽をディグる{% endblock %}
{% block description %}{{ post.artist.name }} の投稿。新しい音楽発見は Chilaq で。{% endblock %}
{% block og_type %}article{% endblock %}
{% block og_image %}{{ og_image_url }}{% endblock %}
{# thumb_of(post) が絶対URLを返す実装だと望ましい。もし相対の場合はサーバ側で絶対化するか、ここで request.url_for を使う #}

{% block content %}
  <div class="row">
    <div class="col-lg-8">
      <h2 class="fw-bold">{{ post.title }}</h2>
      <p><a href="/artist/{{ post.artist.slug }}" class="text-decoration-none">{{ post.artist.name }}</a></p>

      {% if embeds.youtube %}
      <div class="ratio ratio-16x9 mb-3">
        <iframe src="{{ embeds.youtube }}" allowfullscreen></iframe>
      </div>
      {% endif %}

      {% if embeds.spotify %}
      <div class="mb-3">
        <iframe style="border-radius:12px" src="{{ embeds.spotify }}" width="100%" height="152" frameBorder="0" allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture" loading="lazy"></iframe>
      </div>
      {% endif %}

      {% if embeds.apple %}
        <iframe
          src="{{ embeds.apple }}"
          width="100%"
          height="{{ embeds.apple_h }}"
          style="border-radius:12px; overflow:hidden; background:transparent;"
          frameborder="0"
          loading="lazy"
          allow="autoplay *; encrypted-media *; clipboard-write; fullscreen *; picture-in-picture"
          sandbox="allow-forms allow-popups allow-same-origin allow-scripts allow-top-navigation-by-user-activation">
        </iframe>
      {% endif %}
    </div>
    <div class="col-lg-4">
      <div class="sticky-top" style="top:1rem">

        <div class="justify-content-end mb-3">
          <button class="like-btn {{ 'liked' if request.cookies.get('liked_' ~ post.id|string) == '1' else '' }}" id="like-btn-{{ post.id }}" data-post-id="{{ post.id }}" type="button" onclick="likePost({{ post.id }})">
          <span class="heart">♥</span>
          <span class="like-count" id="like-count-{{ post.id }}">{{ post.likes or 0 }}</span>
        </button>
        </div>
        <div class="card p-3">
          <h6 class="fw-bold">Share</h6>
          <a class="btn btn-outline-secondary btn-sm" href="https://x.com/intent/tweet?url={{ request.url }}">Post to X</a>
        </div>
      </div>
    </div>
  </div>
{% endblock %}
