{% extends "base.html" %}
{% block metaproperty %}
<meta property="og:url" content="https://www.chilaq.jp/p/{{post.slug}}"/>
<meta property="og:type" content="website"/>
<meta property="og:title" content="{{ post.title }} / {{post.artist.name}} - Chilaq"/>
<meta property="og:description" content="もっと、好きな音楽をディグるための音楽サイト"/>
<meta property="og:site_name" content="Chilaq"/>
<meta property="og:image" content="{{ thumb_of(post) }}"/>
<meta property="twitter:title" content="{{ post.title }} / {{post.artist.name}} - Chilaq"/>
<meta property="twitter:description" content="もっと、好きな音楽をディグるための音楽サイト"/>
<meta property="twitter:image" content="{{ thumb_of(post) }}"/>

{% endblock %}
{% block title %}{{ post.title }} / {{post.artist.name}} - Chilaq{% endblock %}
{% block content %}
  <div class="row g-4">
    <div class="col-12 col-lg-8">
      <!-- タイトルとアーティスト名 -->
      <h2 class="mb-2">{{ post.title }}</h2>
      {% if post.artist and post.artist.name %}
        <div class="text-muted mb-3">
          <a href="/artist/{{ post.artist.slug or post.artist.id }}" class="text-decoration-none">{{ post.artist.name }}</a>
        </div>
      {% endif %}
      
      <!-- 埋め込みプレーヤー -->
      {% if embeds.youtube %}
        <div class="ratio ratio-16x9 mb-3">
          <iframe allowfullscreen src="{{ embeds.youtube }}"></iframe>
        </div>
      {% endif %}
      
      {% if embeds.spotify %}
        <div class="mb-3">
          <iframe style="width:100%;height:152px;border:0" allow="encrypted-media" src="{{ embeds.spotify }}"></iframe>
        </div>
      {% endif %}
      
      {% if embeds.apple %}
        <div class="mb-3">
          <iframe style="width:100%;border:0;overflow:hidden;background:transparent;"
                  allow="autoplay *; encrypted-media *;"
                  src="{{ embeds.apple }}"></iframe>
        </div>
      {% endif %}
      
      <!-- いいねボタンとシェアボタン（埋め込みの直下に配置） -->
      <div class="d-flex align-items-center gap-2 mb-3">
        <button 
          class="like-btn like-btn-lg {% if request.cookies.get('liked_' ~ post.id|string) == '1' %}liked{% endif %}"
          type="button"
          data-like-btn="{{ post.id }}">
          <span class="heart">♥</span>
          <span class="count" data-like-count="{{ post.id }}">{{ post.likes or 0 }}</span>
        </button>
        
        <a href="http://twitter.com/share?url=https://www.chilaq.jp/p/{{post.slug}}&text=【{{post.title}} - {{post.artist.name}}】を発掘しました！" target="_blank">
          <button type="button" class="btn btn-dark">
            <span>Xでシェア</span>
          </button>
        </a>
      </div>
      
      <!-- 説明文（bodyがある場合のみ表示） -->
      {% if post.body and post.body.strip() %}
        <div class="mt-4 p-3 bg-light rounded">
          <p class="mb-0">{{ post.body }}</p>
        </div>
      {% endif %}
    </div>
    
    <!-- サイドバー（デスクトップのみ） -->
    <div class="col-12 col-lg-4 d-none d-lg-block">
      
      <!-- モバイルでは非表示、デスクトップではサイドバーに追加情報を表示可能 -->
      {% if post.artist %}
        <div class="mt-3">
          <a href="/artist/{{ post.artist.slug or post.artist.id }}" class="btn btn-outline-secondary w-100">
            {{ post.artist.name }}の他の曲を見る
          </a>
        </div>
      {% endif %}
    </div>
  </div>
  
  <!-- モバイル用：画像とアーティストリンク -->
  <div class="row mt-4 d-lg-none">
    <div class="col-12">
      {% if post.artist %}
        <a href="/artist/{{ post.artist.slug or post.artist.id }}" class="btn btn-outline-secondary w-100">
          {{ post.artist.name }}の他の曲を見る
        </a>
      {% endif %}
    </div>
  </div>
{% endblock %}